/*
 * author: Miller Augusto S. Martins
 * e-mail: miller.augusto@gmail.com
 * github: miamarti
 * */
!function(n,e){"use strict";angular.module("ng.ckeditor",["ng"]).directive("ngCkeditor",["$timeout",function(l){return CKEDITOR.on("instanceCreated",function(n){var e=n.editor;"simpleEditor"==e.element.getAttribute("class")&&e.on("configLoaded",function(){e.config.removePlugins="colorbutton,find,flash,font, forms,iframe,image,newpage,removeformat, smiley,specialchar,stylescombo,templates",e.removeButtons="About",e.config.toolbarGroups=[{name:"editing",groups:["basicstyles","links"]},{name:"undo"},{name:"clipboard",groups:["selection","clipboard"]}]})}),{restrict:"E",scope:{ngModel:"=ngModel",ngChange:"=ngChange",ngDisabled:"=ngDisabled",ngConfig:"=ngConfig"},link:function(o,i,a){i[0].innerHTML='<div class="ng-ckeditor"></div> <div class="totalTypedCharacters"></div>';var e=i[0].querySelectorAll(".ng-ckeditor"),t={removeButtons:null!=a.removeButtons?"About,"+a.removeButtons:"About",readOnly:!!o.ngDisabled&&o.ngDisabled};null!=a.removePlugins&&(t.removePlugins=a.removePlugins),null!=a.skin&&(t.skin=a.skin),null!=a.width&&(t.width=a.width),null!=a.height&&(t.height=a.height),null!=a.resizeEnabled&&(t.resize_enabled="false"!=a.resizeEnabled);var g=CKEDITOR.appendTo(e[0],o.ngConfig?o.ngConfig:t,""),r=function(t){t.on("change",function(n){l(function(){o.ngModel=n.editor.getData()}),i&&void 0!==a.msnCount&&(i[0].querySelector(".totalTypedCharacters").innerHTML=a.msnCount+" "+n.editor.getData().length),o.ngChange&&"function"==typeof o.ngChange&&o.ngChange(n.editor.getData())}),t.on("focus",function(n){o.ngModel!==t.getData()&&t.setData(o.ngModel)}),t.on("mode",function(n){if("source"==this.mode){var e=n.editor.editable();e.attachListener(e,"input",function(){o.ngModel=t.getData(),i&&void 0!==a.msnCount&&(i[0].querySelector(".totalTypedCharacters").innerHTML=a.msnCount+" "+n.editor.getData().length),o.ngChange&&"function"==typeof o.ngChange&&o.ngChange(n.editor.getData())})}})};r(g),o.$watch("ngModel",function(n){n!==g.getData()&&g.setData(n||"")}),o.$watch("ngDisabled",function(n){t.readOnly=!!n,g.destroy(),g=CKEDITOR.appendTo(e[0],o.ngConfig?o.ngConfig:t,""),r(g),g.setData(o.ngModel)})}}}])}(window,document);